<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Admin - Gestione Prodotti">
  <meta name="robots" content="noindex,nofollow">
  <title>Admin - Gestione Prodotti</title>
  <link rel="stylesheet" href="css/styles.css">
  <style>
    .admin-container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }
    .admin-section {
      background: #2a2a2a;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 20px;
    }
    .form-group {
      margin-bottom: 15px;
    }
    .form-group label {
      display: block;
      margin-bottom: 5px;
      color: #e0e0e0;
      font-weight: 500;
    }
    .form-group input,
    .form-group textarea,
    .form-group select {
      width: 100%;
      padding: 10px;
      background: #1a1a1a;
      border: 1px solid #444;
      border-radius: 4px;
      color: #e0e0e0;
      font-family: inherit;
    }
    .form-group textarea {
      resize: vertical;
      min-height: 100px;
    }
    .btn-primary {
      background: #d4af37;
      color: #000;
      padding: 12px 24px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.3s ease;
    }
    .btn-primary:hover {
      background: #e0c158;
      transform: translateY(-2px);
    }
    .btn-danger {
      background: #dc3545;
      color: #fff;
      padding: 8px 16px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 0.9em;
    }
    .products-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }
    .product-card {
      background: #1a1a1a;
      border: 1px solid #444;
      border-radius: 8px;
      padding: 15px;
      position: relative;
    }
    .product-card img {
      width: 100%;
      height: 200px;
      object-fit: cover;
      border-radius: 4px;
      margin-bottom: 10px;
    }
    .product-card h3 {
      margin: 10px 0 5px 0;
      color: #d4af37;
    }
    .product-card p {
      margin: 5px 0;
      font-size: 0.9em;
      color: #999;
    }
    .product-actions {
      display: flex;
      gap: 10px;
      margin-top: 10px;
    }
    .btn-edit, .btn-delete {
      flex: 1;
      padding: 8px;
      text-align: center;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 0.85em;
    }
    .btn-edit {
      background: #0066cc;
      color: #fff;
    }
    .btn-delete {
      background: #dc3545;
      color: #fff;
    }
    .btn-ad {
      background: #1f7a3d;
      color: #fff;
      flex: 1;
      padding: 8px;
      text-align: center;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 0.85em;
    }
    .alert {
      padding: 15px;
      border-radius: 4px;
      margin-bottom: 20px;
    }
    .alert-success {
      background: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }
    .alert-error {
      background: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }
    .form-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
    }
    @media (max-width: 768px) {
      .form-row {
        grid-template-columns: 1fr;
      }
    }
    .publish-panel {
      border: 1px solid #444;
      background: #171717;
    }
    .publish-panel p,
    .publish-panel li {
      color: #bbb;
    }
    .publish-panel ul {
      margin: 10px 0 15px 22px;
    }
    .publish-actions {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 12px;
    }
    .btn-secondary {
      background: #4a4a4a;
      color: #fff;
      padding: 10px 14px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-weight: 600;
    }
    .file-inline {
      display: flex;
      align-items: center;
      gap: 10px;
      flex-wrap: wrap;
      margin-top: 8px;
    }
    .token-input {
      min-width: 320px;
    }
    .status-note {
      font-size: 0.9em;
      color: #a9a9a9;
      margin-top: 8px;
    }
  </style>
</head>
<body>
  <div id="app">
    <header class="navbar">
      <div class="navbar-container">
        <a href="index.html" class="navbar-brand">
          <img src="assets/brand/logo.svg" alt="ENS Antiquariato" class="logo" loading="lazy" width="40" height="40" decoding="async">
          <span>ENS Antiquariato - Admin</span>
        </a>
        <nav class="navbar-menu">
          <a href="index.html" class="nav-link">Home</a>
          <a href="catalogo.html" class="nav-link">Catalogo</a>
          <a href="admin-products.html" class="nav-link active">Admin</a>
        </nav>
      </div>
    </header>

    <main class="admin-container">
      <h1 style="color: #d4af37; margin-bottom: 30px;">üì¶ Gestione Prodotti</h1>

      <div id="alert-container"></div>

      <div class="admin-section publish-panel">
        <h2>Pubblica Annunci Online</h2>
        <p>Questa pagina modifica il catalogo locale del browser. Per pubblicare davvero gli annunci sul sito online:</p>
        <ul>
          <li>modifica prodotti qui;</li>
          <li>scarica il file <code>products.json</code> aggiornato;</li>
          <li>sostituisci il file in <code>data/products.json</code> nel progetto;</li>
          <li>esegui commit e push su GitHub.</li>
        </ul>
        <div class="file-inline">
          <label for="products-file-input">Importa products.json:</label>
          <input type="file" id="products-file-input" accept="application/json">
        </div>
        <div class="file-inline">
          <label for="gh-token">Accesso Admin (Token GitHub):</label>
          <input type="password" id="gh-token" class="token-input" placeholder="github_pat_..." autocomplete="off" spellcheck="false" inputmode="text">
          <label style="display:inline-flex;align-items:center;gap:8px;color:#bbb;">
            <input type="checkbox" id="gh-remember">
            Ricorda in questo browser
          </label>
        </div>
        <div class="publish-actions">
          <button type="button" id="btn-export-json" class="btn-secondary">Scarica products.json</button>
          <button type="button" id="btn-sync-live" class="btn-secondary">Ricarica da dati pubblicati</button>
          <button type="button" id="btn-copy-git" class="btn-secondary">Copia comandi Git</button>
          <button type="button" id="btn-gh-publish" class="btn-secondary">Pubblica online adesso</button>
        </div>
        <p id="publish-status" class="status-note">Catalogo locale: 0 prodotti.</p>
      </div>

      <!-- Form Aggiunta/Modifica Prodotto -->
      <div class="admin-section">
        <h2>Aggiungi o Modifica Prodotto</h2>
        <form id="product-form">
          <div class="form-row">
            <div class="form-group">
              <label for="name">Nome Prodotto *</label>
              <input type="text" id="name" name="name" required>
            </div>
            <div class="form-group">
              <label for="category">Categoria *</label>
              <select id="category" name="category" required>
                <option value="">-- Seleziona --</option>
                <option value="mobili">Mobili</option>
                <option value="arte">Arte</option>
                <option value="ceramica">Ceramica</option>
                <option value="orologeria">Orologeria</option>
                <option value="oggetti">Oggetti</option>
                <option value="gioielli">Gioielli</option>
              </select>
            </div>
          </div>

          <div class="form-group">
            <label for="description">Descrizione *</label>
            <textarea id="description" name="description" required></textarea>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="price">Prezzo (‚Ç¨) *</label>
              <input type="number" id="price" name="price" step="0.01" min="0" required>
            </div>
            <div class="form-group">
              <label for="year">Periodo (es: 1880-1890)</label>
              <input type="text" id="year" name="year">
            </div>
          </div>

          <div class="form-group">
            <label for="dimensions">Dimensioni</label>
            <input type="text" id="dimensions" name="dimensions" placeholder="L 120cm √ó H 90cm √ó P 50cm">
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="status">Stato *</label>
              <select id="status" name="status" required>
                <option value="available">Disponibile</option>
                <option value="reserved">Prenotato</option>
                <option value="sold">Venduto</option>
              </select>
            </div>
            <div class="form-group">
              <label for="featured">
                <input type="checkbox" id="featured" name="featured"> Featured (In primo piano)
              </label>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="stripe-link">Link Stripe per pagamento</label>
              <input type="url" id="stripe-link" name="stripeLinkBuy" placeholder="https://buy.stripe.com/...">
            </div>
            <div class="form-group">
              <label for="paypal-link">Link PayPal per pagamento</label>
              <input type="url" id="paypal-link" name="paypalBuy" placeholder="https://www.paypal.com/...">
            </div>
          </div>

          <div class="form-group">
            <label for="whatsapp-text">Testo WhatsApp</label>
            <input type="text" id="whatsapp-text" name="whatsappText" placeholder="Testo da inviare su WhatsApp">
          </div>

          <div class="form-group">
            <label for="image-url">URL Immagine Principale</label>
            <input type="url" id="image-url" name="image" placeholder="assets/products/...">
          </div>

          <div class="form-group">
            <label for="gallery-urls">URL Galleria (separati da virgola)</label>
            <input type="text" id="gallery-urls" name="gallery" placeholder="assets/products/1.jpg, assets/products/2.jpg">
          </div>

          <div style="display: flex; gap: 10px;">
            <button type="submit" class="btn-primary" id="btn-save-product">üíæ Salva Prodotto</button>
            <button type="button" class="btn-primary" style="background: #666;" id="btn-clear">üóëÔ∏è Pulisci Form</button>
          </div>
        </form>
      </div>

      <!-- Lista Prodotti -->
      <div class="admin-section">
        <h2>Prodotti Attuali (<span id="product-count">0</span>)</h2>
        <div id="products-list" class="products-grid"></div>
      </div>
    </main>

    <footer style="text-align: center; padding: 20px; color: #666; margin-top: 40px;">
      <p>¬© 2026 ENS Antiquariato - Admin Panel</p>
    </footer>
  </div>

  <script>
    // Gestione LocalStorage per prodotti
    const STORAGE_KEY = 'antiquariato_products';
    const LIVE_DATA_PATH = 'data/products.json';
    const PUBLIC_SITE_BASE = 'https://egly87.github.io/ensantiquarato.github.io/';
    const GITHUB_OWNER = 'Egly87';
    const GITHUB_REPO = 'ensantiquarato.github.io';
    const GITHUB_BRANCH = 'main';
    const GITHUB_PRODUCTS_PATH = 'data/products.json';
    const GITHUB_TOKEN_STORAGE_KEY = 'ens_admin_github_token';

    function loadProducts() {
      try {
        const json = localStorage.getItem(STORAGE_KEY);
        return json ? JSON.parse(json) : [];
      } catch (err) {
        console.error(err);
        return [];
      }
    }

    function saveProducts(products) {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(products));
      renderProducts();
    }

    function showAlert(message, type = 'success') {
      const alertContainer = document.getElementById('alert-container');
      const alert = document.createElement('div');
      alert.className = `alert alert-${type}`;
      alert.textContent = message;
      alertContainer.innerHTML = '';
      alertContainer.appendChild(alert);
      setTimeout(() => alert.remove(), 4000);
    }

    function updatePublishStatus() {
      const count = loadProducts().length;
      const statusEl = document.getElementById('publish-status');
      if (statusEl) {
        statusEl.textContent = `Catalogo locale: ${count} prodotti.`;
      }
    }

    function generateId() {
      return Math.max(0, ...loadProducts().map(p => p.id || 0)) + 1;
    }

    function loadGithubToken() {
      return sessionStorage.getItem(GITHUB_TOKEN_STORAGE_KEY)
        || localStorage.getItem(GITHUB_TOKEN_STORAGE_KEY)
        || '';
    }

    function saveGithubToken(token, remember) {
      // Never store on the server; this is client-only. Still: treat it as sensitive.
      sessionStorage.removeItem(GITHUB_TOKEN_STORAGE_KEY);
      localStorage.removeItem(GITHUB_TOKEN_STORAGE_KEY);
      if (!token) return;
      if (remember) localStorage.setItem(GITHUB_TOKEN_STORAGE_KEY, token);
      else sessionStorage.setItem(GITHUB_TOKEN_STORAGE_KEY, token);
    }

    function base64EncodeUnicode(str) {
      return btoa(unescape(encodeURIComponent(str)));
    }

    async function githubRequest(url, { method = 'GET', token = '', body = null } = {}) {
      const headers = {
        'Accept': 'application/vnd.github+json',
        'X-GitHub-Api-Version': '2022-11-28'
      };
      if (token) headers['Authorization'] = `Bearer ${token}`;
      if (body !== null) headers['Content-Type'] = 'application/json';

      const res = await fetch(url, {
        method,
        headers,
        body: body === null ? null : JSON.stringify(body)
      });

      const text = await res.text();
      let data = null;
      try { data = text ? JSON.parse(text) : null; } catch { data = text; }

      if (!res.ok) {
        const msg = data && typeof data === 'object' && data.message ? data.message : String(text || res.statusText);
        throw new Error(`GitHub API ${res.status}: ${msg}`);
      }
      return data;
    }

    async function publishProductsToGithub(products) {
      const token = loadGithubToken();
      if (!token) {
        throw new Error('Inserisci il Token GitHub per pubblicare online.');
      }
      const url = `https://api.github.com/repos/${GITHUB_OWNER}/${GITHUB_REPO}/contents/${GITHUB_PRODUCTS_PATH}`;

      // 1) Get current sha
      const current = await githubRequest(`${url}?ref=${encodeURIComponent(GITHUB_BRANCH)}`, { token });
      const sha = current && current.sha ? current.sha : null;
      if (!sha) throw new Error('Impossibile leggere lo SHA del file remoto.');

      // 2) Upload new content
      const json = JSON.stringify(products, null, 2) + '\n';
      const now = new Date();
      const stamp = `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}-${String(now.getDate()).padStart(2, '0')} ${String(now.getHours()).padStart(2, '0')}:${String(now.getMinutes()).padStart(2, '0')}`;
      const payload = {
        message: `Aggiorna annunci (${stamp})`,
        content: base64EncodeUnicode(json),
        sha,
        branch: GITHUB_BRANCH
      };

      try {
        return await githubRequest(url, { method: 'PUT', token, body: payload });
      } catch (err) {
        // If there was a race (file updated), refresh sha and retry once.
        if (String(err.message || '').includes('409')) {
          const refreshed = await githubRequest(`${url}?ref=${encodeURIComponent(GITHUB_BRANCH)}`, { token });
          const newSha = refreshed && refreshed.sha ? refreshed.sha : null;
          if (!newSha) throw err;
          payload.sha = newSha;
          return await githubRequest(url, { method: 'PUT', token, body: payload });
        }
        throw err;
      }
    }

    async function loadLiveProducts() {
      const response = await fetch(LIVE_DATA_PATH);
      if (!response.ok) {
        throw new Error('Impossibile leggere data/products.json');
      }
      const products = await response.json();
      if (!Array.isArray(products)) {
        throw new Error('Il file data/products.json non contiene un array');
      }
      return products;
    }

    async function initializeProductsIfEmpty() {
      const products = loadProducts();
      if (products.length > 0) {
        renderProducts();
        return;
      }
      try {
        const liveProducts = await loadLiveProducts();
        saveProducts(liveProducts);
        showAlert('Catalogo inizializzato dai dati pubblicati.');
      } catch (err) {
        showAlert(err.message, 'error');
      }
    }

    function downloadProductsJson() {
      const products = loadProducts();
      const blob = new Blob([JSON.stringify(products, null, 2)], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const link = document.createElement('a');
      link.href = url;
      link.download = 'products.json';
      link.click();
      URL.revokeObjectURL(url);
    }

    function formatPriceForAd(product) {
      if (typeof product.price === 'number' && !Number.isNaN(product.price)) {
        return `EUR ${product.price.toFixed(2)}`;
      }
      return 'Su richiesta';
    }

    function buildProductUrl(productId) {
      return new URL(`prodotto.html?id=${productId}`, PUBLIC_SITE_BASE).toString();
    }

    async function copyTextToClipboard(text) {
      if (navigator.clipboard && window.isSecureContext) {
        await navigator.clipboard.writeText(text);
        return;
      }
      const area = document.createElement('textarea');
      area.value = text;
      document.body.appendChild(area);
      area.select();
      document.execCommand('copy');
      area.remove();
    }

    async function copyAdText(productId) {
      const product = loadProducts().find((p) => p.id === productId);
      if (!product) {
        showAlert('Prodotto non trovato.', 'error');
        return;
      }
      const adText = [
        `${product.name}`,
        `Prezzo: ${formatPriceForAd(product)}`,
        `Categoria: ${product.category || 'N/D'}`,
        `Periodo: ${product.year || 'N/D'}`,
        product.description || '',
        `Link: ${buildProductUrl(product.id)}`,
        `Email: egli87@yahoo.com`,
        `Contatto: +39 329 662 7575`
      ].filter(Boolean).join('\n');

      try {
        await copyTextToClipboard(adText);
        showAlert('Testo annuncio copiato.');
      } catch (err) {
        console.error(err);
        showAlert('Impossibile copiare il testo annuncio.', 'error');
      }
    }

    // Form submission
    document.getElementById('product-form').addEventListener('submit', (e) => {
      e.preventDefault();
      const form = e.target;
      const formData = new FormData(form);
      
      const product = {
        id: parseInt(formData.get('id')) || generateId(),
        name: formData.get('name'),
        category: formData.get('category'),
        description: formData.get('description'),
        price: parseFloat(formData.get('price')),
        year: formData.get('year'),
        dimensions: formData.get('dimensions'),
        status: formData.get('status'),
        featured: formData.get('featured') ? true : false,
        image: formData.get('image'),
        gallery: formData.get('gallery')
          .split(',')
          .map(url => url.trim())
          .filter(url => url),
        stripeLinkBuy: formData.get('stripeLinkBuy'),
        paypalBuy: formData.get('paypalBuy'),
        whatsappText: formData.get('whatsappText')
      };

      let products = loadProducts();
      const index = products.findIndex(p => p.id === product.id);
      
      if (index >= 0) {
        products[index] = product;
        showAlert('‚úÖ Prodotto aggiornato!');
      } else {
        products.push(product);
        showAlert('‚úÖ Prodotto aggiunto!');
      }

      saveProducts(products);
      form.reset();
      document.getElementById('product-form').querySelector('input[name="id"]')?.remove();
      document.getElementById('btn-save-product').textContent = 'üíæ Salva Prodotto';
    });

    document.getElementById('btn-clear').addEventListener('click', () => {
      document.getElementById('product-form').reset();
      document.getElementById('product-form').querySelector('input[name="id"]')?.remove();
      document.getElementById('btn-save-product').textContent = 'üíæ Salva Prodotto';
    });

    document.getElementById('btn-export-json').addEventListener('click', () => {
      downloadProductsJson();
      showAlert('File products.json scaricato.');
    });

    document.getElementById('btn-sync-live').addEventListener('click', async () => {
      if (!confirm('Sostituire il catalogo locale con i dati attualmente pubblicati?')) return;
      try {
        const liveProducts = await loadLiveProducts();
        saveProducts(liveProducts);
        showAlert('Catalogo locale sincronizzato con i dati pubblicati.');
      } catch (err) {
        showAlert(err.message, 'error');
      }
    });

    document.getElementById('products-file-input').addEventListener('change', async (event) => {
      const file = event.target.files?.[0];
      if (!file) return;
      try {
        const text = await file.text();
        const parsed = JSON.parse(text);
        if (!Array.isArray(parsed)) {
          throw new Error('Il file selezionato non contiene un array di prodotti.');
        }
        saveProducts(parsed);
        showAlert('Catalogo importato dal file selezionato.');
      } catch (err) {
        showAlert(err.message, 'error');
      }
    });

    document.getElementById('btn-copy-git').addEventListener('click', async () => {
      const gitCommands = [
        'cp ~/Downloads/products.json data/products.json',
        'git add data/products.json',
        'git commit -m "Aggiorna annunci"',
        'git push origin main'
      ].join('\n');
      try {
        await copyTextToClipboard(gitCommands);
        showAlert('Comandi Git copiati negli appunti.');
      } catch (err) {
        showAlert('Impossibile copiare i comandi Git.', 'error');
      }
    });

    // GitHub token field (client-side "login")
    (function initGithubTokenUi() {
      const tokenInput = document.getElementById('gh-token');
      const rememberCheckbox = document.getElementById('gh-remember');
      const stored = loadGithubToken();
      if (stored) tokenInput.value = stored;
      if (localStorage.getItem(GITHUB_TOKEN_STORAGE_KEY)) rememberCheckbox.checked = true;

      tokenInput.addEventListener('change', () => {
        const token = tokenInput.value.trim();
        saveGithubToken(token, rememberCheckbox.checked);
      });
      rememberCheckbox.addEventListener('change', () => {
        const token = tokenInput.value.trim();
        saveGithubToken(token, rememberCheckbox.checked);
      });
    })();

    document.getElementById('btn-gh-publish').addEventListener('click', async () => {
      if (!confirm('Pubblicare online adesso? Questo aggiorna data/products.json su GitHub e rende gli annunci visibili sul sito.')) return;
      try {
        const products = loadProducts();
        const result = await publishProductsToGithub(products);
        const commitUrl = result && result.commit && result.commit.html_url ? result.commit.html_url : '';
        showAlert(commitUrl ? `Pubblicato online! Commit: ${commitUrl}` : 'Pubblicato online!');
      } catch (err) {
        showAlert(err.message || 'Errore durante la pubblicazione.', 'error');
      }
    });

    function renderProducts() {
      const products = loadProducts();
      const container = document.getElementById('products-list');
      const count = document.getElementById('product-count');

      count.textContent = products.length;

      container.innerHTML = products.map(product => `
        <div class="product-card">
          <img src="${product.image || 'assets/brand/og-1200x630.jpg'}" alt="${product.name}" onerror="this.src='assets/brand/og-1200x630.jpg'">
          <h3>${product.name}</h3>
          <p><strong>Categoria:</strong> ${product.category}</p>
          <p><strong>Prezzo:</strong> ‚Ç¨${Number(product.price || 0).toFixed(2)}</p>
          <p><strong>Status:</strong> <span style="color: ${
            product.status === 'available' ? '#4caf50' : 
            product.status === 'reserved' ? '#ff9800' : '#dc3545'
          }">${product.status}</span></p>
          <p><strong>Periodo:</strong> ${product.year || 'N/A'}</p>
          <div class="product-actions">
            <button class="btn-edit" onclick="editProduct(${product.id})">‚úèÔ∏è Modifica</button>
            <button class="btn-ad" onclick="copyAdText(${product.id})">üìã Copia Annuncio</button>
            <button class="btn-delete" onclick="deleteProduct(${product.id})">üóëÔ∏è Elimina</button>
          </div>
        </div>
      `).join('');
      updatePublishStatus();
    }

    function editProduct(id) {
      const products = loadProducts();
      const product = products.find(p => p.id === id);
      if (!product) return;

      document.getElementById('name').value = product.name;
      document.getElementById('category').value = product.category;
      document.getElementById('description').value = product.description;
      document.getElementById('price').value = product.price;
      document.getElementById('year').value = product.year;
      document.getElementById('dimensions').value = product.dimensions;
      document.getElementById('status').value = product.status;
      document.getElementById('featured').checked = product.featured;
      document.getElementById('stripe-link').value = product.stripeLinkBuy;
      document.getElementById('paypal-link').value = product.paypalBuy;
      document.getElementById('whatsapp-text').value = product.whatsappText;
      document.getElementById('image-url').value = product.image;
      document.getElementById('gallery-urls').value = Array.isArray(product.gallery) ? product.gallery.join(', ') : '';

      // Aggiungi ID nascosto
      let idInput = document.querySelector('input[name="id"]');
      if (!idInput) {
        idInput = document.createElement('input');
        idInput.type = 'hidden';
        idInput.name = 'id';
        document.getElementById('product-form').appendChild(idInput);
      }
      idInput.value = id;

      document.getElementById('btn-save-product').textContent = 'üíæ Aggiorna Prodotto';
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    function deleteProduct(id) {
      if (!confirm('Sei sicuro di voler eliminare questo prodotto?')) return;

      let products = loadProducts();
      products = products.filter(p => p.id !== id);
      saveProducts(products);
      showAlert('‚úÖ Prodotto eliminato!');
    }

    // Load products on page load
    initializeProductsIfEmpty();
    renderProducts();
  </script>
</body>
</html>
